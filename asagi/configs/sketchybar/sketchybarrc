#!/bin/bash

# SketchyBar Configuration
# Based on reference setup with comprehensive widget support

PLUGIN_DIR="$HOME/.config/sketchybar/plugins"
SKETCHYBAR="/opt/homebrew/opt/sketchybar/bin/sketchybar"

# Load color definitions
source "$HOME/.config/sketchybar/colors.sh"

# Bar Configuration
${SKETCHYBAR} --bar height=36 \
                 blur_radius=30 \
                 position=top \
                 sticky=off \
                 padding_left=10 \
                 padding_right=10 \
                 color=$BAR_COLOR \
                 margin=15 \
                 y_offset=5 \
                 corner_radius=12 \
                 border_width=0

# Default item settings
${SKETCHYBAR} --default icon.font="JetBrainsMono Nerd Font:Bold:16.0" \
                     icon.color=$WHITE \
                     label.font="JetBrainsMono Nerd Font:Medium:13.0" \
                     label.color=$WHITE \
                     padding_left=6 \
                     padding_right=6 \
                     label.padding_left=6 \
                     label.padding_right=2 \
                     icon.padding_left=6 \
                     icon.padding_right=4 \
                     background.color=$ITEM_BG_COLOR \
                     background.corner_radius=6 \
                     background.height=26

# Popup default styling
${SKETCHYBAR} --default popup.background.color=$GROUP_BG_COLOR \
                     popup.background.corner_radius=8 \
                     popup.background.border_width=0 \
                     popup.blur_radius=30 \
                     popup.background.shadow.drawing=on \
                     popup.background.shadow.color=0x80000000 \
                     popup.background.shadow.angle=90 \
                     popup.background.shadow.distance=5

# Left Side Items

# Apple Logo
${SKETCHYBAR} --add item apple.logo left \
           --set apple.logo icon= \
                            icon.font="JetBrainsMono Nerd Font:Bold:16.0" \
                            background.padding_left=8 \
                            background.padding_right=12 \
                            label.drawing=off \
                            click_script="$PLUGIN_DIR/apple.sh"

# Spaces (Virtual Desktops)
SPACE_ICONS=("1" "2" "3" "4" "5" "6" "7" "8" "9" "10")

for i in "${!SPACE_ICONS[@]}"
do
  sid=$(($i+1))
  ${SKETCHYBAR} --add space space.$sid left \
             --set space.$sid associated_space=$sid \
                              icon=${SPACE_ICONS[i]} \
                              icon.padding_left=8 \
                              icon.padding_right=8 \
                              background.drawing=off \
                              label.drawing=off \
                              script="$PLUGIN_DIR/spaces.sh" \
                              click_script="yabai -m space --focus $sid"
done

# Group all spaces with a bracket
${SKETCHYBAR} --add bracket spaces_group '/space\..*/' \
           --set spaces_group background.color=$GROUP_BG_COLOR \
                              background.corner_radius=6 \
                              background.height=28 \
                              background.border_width=0

# Front App (Current Application) with icon
${SKETCHYBAR} --add item front_app left \
           --set front_app background.color=$ACCENT_COLOR \
                           background.corner_radius=6 \
                           background.height=28 \
                           background.padding_left=8 \
                           background.padding_right=8 \
                           icon.color=$WHITE \
                           icon.drawing=on \
                           icon.font="JetBrainsMono Nerd Font:Bold:16.0" \
                           icon.padding_right=8 \
                           label.color=$WHITE \
                           label.font="JetBrainsMono Nerd Font:Semibold:13.0" \
                           script="$PLUGIN_DIR/front_app.sh" \
                           click_script="$PLUGIN_DIR/front_app_click.sh" \
           --subscribe front_app front_app_switched

# Right Side Items

# Network
${SKETCHYBAR} --add item network right \
           --set network update_freq=10 \
                         icon=󰖩 \
                         icon.padding_left=8 \
                         icon.padding_right=4 \
                         background.drawing=off \
                         script="$PLUGIN_DIR/network.sh"

# CPU
${SKETCHYBAR} --add item cpu right \
           --set cpu update_freq=5 \
                     icon=󰘚 \
                     icon.padding_left=8 \
                     icon.padding_right=4 \
                     background.drawing=off \
                     script="$PLUGIN_DIR/cpu.sh"

# Volume
${SKETCHYBAR} --add item volume right \
           --set volume icon.padding_left=8 \
                        icon.padding_right=4 \
                        background.drawing=off \
                        script="$PLUGIN_DIR/volume.sh" \
                        click_script="$PLUGIN_DIR/volume_toggle_mute.sh" \
           --subscribe volume volume_change

# Battery
${SKETCHYBAR} --add item battery right \
           --set battery update_freq=120 \
                         icon.padding_left=8 \
                         icon.padding_right=4 \
                         background.drawing=off \
                         script="$PLUGIN_DIR/battery.sh" \
           --subscribe battery system_woke power_source_change

# Group system status items (network, cpu, volume, battery)
${SKETCHYBAR} --add bracket system_status network cpu volume battery \
           --set system_status background.color=$GROUP_BG_COLOR \
                               background.corner_radius=6 \
                               background.height=28 \
                               background.border_width=0

# Clock (separate from system status for emphasis)
${SKETCHYBAR} --add item clock right \
           --set clock update_freq=10 \
                       icon= \
                       icon.padding_left=8 \
                       icon.padding_right=4 \
                       label.padding_right=8 \
                       background.color=$GROUP_BG_COLOR \
                       background.corner_radius=6 \
                       background.height=28 \
                       background.border_width=0 \
                       script="$PLUGIN_DIR/clock.sh"

# Volume popup (center of screen)
${SKETCHYBAR} --add item volume_popup center \
           --set volume_popup drawing=off \
                              icon.font="JetBrainsMono Nerd Font:Bold:32.0" \
                              label.font="JetBrainsMono Nerd Font:Bold:24.0" \
                              background.color=$GROUP_BG_COLOR \
                              background.corner_radius=12 \
                              background.height=80 \
                              background.padding_left=20 \
                              background.padding_right=20 \
                              icon.padding_right=10

# Finalize
${SKETCHYBAR} --update
